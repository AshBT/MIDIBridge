(function(){function w(){j=k.getMIDIAccess();f=k.getSequencer();var c=function(a){return a.replace(/data:audio\/mid[i]?;base64,/,"")};p={addEventListener:function(a,b){f.addEventListener(a,{listener:b})},stop:function(){f.stop()},play:function(){f.play()},pause:function(){f.pause()},loadBase64String:function(a){return f.loadBase64String(c(a))},playBase64String:function(a){return f.playBase64String(c(a))},getMicrosecondPosition:function(){return f.getMicrosecondPosition()},setMicrosecondPosition:function(a){f.setMicrosecondPosition(a)},
setTempoInBPM:function(a){f.setTempoInBPM(a)},getTempoFactor:function(){return f.getTempoFactor()},setTempoFactor:function(a){f.setTempoFactor(a)},getTempoInBPM:function(){return f.getTempoInBPM()},getTracks:function(){return f.getTracks()},muteTrack:function(a){return f.muteTrack(a)},unmuteTrack:function(a){return f.unmuteTrack(a)},getSequence:function(){return f.getSequence()}};var b=function(a){if(!a)return i&&console.log("device does not exist"),null;try{if("input"==a.deviceType)a=j.getInput(a);
else if("output"==a.deviceType)a=j.getOutput(a);else return i&&console.log("error while getting device",a.deviceName),null}catch(b){return i&&console.log("error while getting device",a.deviceName),null}return{close:function(){a.close()},open:function(){if(a.open())return!0;i&&console.log("could not open device",a.deviceName);return!1},addEventListener:function(b,c){a.addEventListener(b,{listener:function(a){l&&1!==l[a.status]?i&&console.log("MIDI message intercepted",a.status,a.channel,a.data1,a.data2):
c(a)}})},sendMIDIMessage:function(b){a.getDevice().isOpen()&&a.sendMIDIMessage(b)},toString:function(){return a.toString()},deviceType:a.deviceType,deviceName:a.deviceName,deviceManufacturer:a.deviceManufacturer,deviceDescription:a.deviceDescription}};s({enumerateInputs:function(){return j.enumerateInputs()},enumerateOutputs:function(){return j.enumerateOutputs()},getInput:function(a){return b(a)},getOutput:function(a){return b(a)},closeInputs:function(){j.closeInputs()},closeOutputs:function(){j.closeOutputs()},
createMIDIMessage:function(a,b,c,e,d){return j.createMIDIMessage(a,b,c,e,d||-1)}})}function x(){var c=document.createElement("div"),b="";"safari/osx"!==g&&-1===g.indexOf("chrome")?(b=b+'<object tabindex="0" id="midibridge-applet" type="application/x-java-applet" height="1" width="1">'+('<param name="codebase" value="'+q+'/" />'),b+='<param name="archive" value="'+t+'" />',b+='<param name="code" value="net.abumarkub.midi.MIDIApplet" /><param name="scriptable" value="true" /><param name="minJavaVersion" value="1.6" />Your browser needs the Java plugin to use the midibridge. You can download it <a href="http://www.java.com/en/" target="blank" title="abumarkub midibridge download java" rel="abumarkub midibridge download java">here</a></object>'):
(b+='<applet id="midibridge-applet" code="net.abumarkub.midi.MIDIApplet.class" archive="'+t+'" codebase="'+q+'" width="1" height="1" mayscript>',b+='<param name="minJavaVersion" value="1.6"></applet>');c.setAttribute("id","midibridge-java");c.innerHTML=b;document.body.appendChild(c)}try{console.log("")}catch(y){console={log:function(){}}}var e={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,MIDI_TIMECODE:241,
SONG_POSITION:242,SONG_SELECT:243,TUNE_REQUEST:246,EOX:247,TIMING_CLOCK:248,START:250,CONTINUE:251,STOP:252,ACTIVE_SENSING:254,SYSTEM_RESET:255,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_SOUNDFONT:"soundfont",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat",version:"0.6.0",noteNameModus:"sharp",userAgent:""},d=[],r=[],m={},u=null,q="java",i=!1,s=null,n=null,l=null,t="midiapplet-"+e.version+".jar",k=null,j=null,f=null,p=null,h=navigator.userAgent.toLowerCase(),
g;-1!==h.indexOf("chrome")?g="chrome":-1!==h.indexOf("safari")?g="safari":-1!==h.indexOf("firefox")?g="firefox":-1!==h.indexOf("opera")?g="opera":-1!==h.indexOf("msie 7")?g="msie7":-1!==h.indexOf("msie 8")?g="msie8":-1!==h.indexOf("msie 9")&&(g="msie9");-1!==h.indexOf("windows")?g+="/win":-1!==h.indexOf("macintosh")&&(g+="/osx");e.userAgent=g;d[128]="NOTE OFF";d[144]="NOTE ON";d[160]="POLY PRESSURE";d[176]="CONTROL CHANGE";d[192]="PROGRAM CHANGE";d[208]="CHANNEL PRESSURE";d[224]="PITCH BEND";d[240]=
"SYSTEM EXCLUSIVE";d[241]="MIDI TIMECODE";d[242]="SONG POSITION";d[243]="SONG SELECT";d[244]="RESERVED 1";d[245]="RESERVED 2";d[246]="TUNE REQUEST";d[247]="EOX";d[248]="TIMING CLOCK";d[249]="RESERVED 3";d[250]="START";d[251]="CONTINUE";d[252]="STOP";d[254]="ACTIVE SENSING";d[255]="SYSTEM RESET";for(var v in d)switch(h=parseInt(v),h){case e.NOTE_OFF:case e.NOTE_ON:case e.POLY_PRESSURE:case e.CONTROL_CHANGE:case e.PROGRAM_CHANGE:case e.CHANNEL_PRESSURE:case e.PITCH_BEND:r.push(h);for(var o=0;16>o;o++)d[h+
o]=d[v];break;default:r.push(h)}m={sharp:"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(","),flat:"C,D&#9837;,D,E&#9837;,E,F,G&#9837;,G,A&#9837;,A,B&#9837;,B".split(","),soundfont:"C,Db,D,Eb,E,F,Gb,G,Ab,A,Bb,B".split(","),"enh-sharp":"B#,C#,C##,D#,D##,E#,F#,F##,G#,G##,A#,A##".split(","),"enh-flat":"D&#9837;&#9837;,D&#9837;,E&#9837;&#9837;,E&#9837;,F&#9837;,G&#9837;&#9837;,G&#9837;,A&#9837;&#9837;,A&#9837;,B&#9837;&#9837;,B&#9837;,C&#9837;".split(",")};e.init=function(){function c(a){document.body.style.color=
"#f00";document.body.style.fontSize="20px";document.body.innerHTML=a+" is not supported."}if("safari/win"===g)c("Safari for Windows");else if("msie7/win"===g)c("Internet Explorer 7");else{u=JSON.parse;var b=Array.prototype.slice.call(arguments);if(1===b.length&&"function"===typeof b[0])s=b[0];else if(2===b.length&&"object"===typeof b[0]&&"function"===typeof b[1]){var a=b[0],d,f,h,j,k;s=b[1];n=a.onError;i=a.debug;q=a.javaDir||q;l={};var m=function(a,b){switch(a){case e.NOTE_OFF:case e.NOTE_ON:case e.POLY_PRESSURE:case e.CONTROL_CHANGE:case e.PROGRAM_CHANGE:case e.CHANNEL_PRESSURE:case e.PITCH_BEND:for(o=
0;16>o;o++)b[a+o]=1;break;default:b[a]=1}};if(void 0!==a.filterCommands){b=0;for(d=r.length;b<d;b++){j=r[b];var p=!1;f=0;for(h=a.filterCommands.length;f<h;f++)if(k=a.filterCommands[f],k==j){p=!0;break}p||m(j,l)}}else if(void 0!==a.passCommands){b=0;for(d=a.passCommands.length;b<d;b++)m(a.passCommands[b],l)}else l=null;i&&console.log(l,g)}if(navigator.javaEnabled()){a=function(){n?n("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+"):i&&console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")};
try{void 0===u?a():x()}catch(t){a()}}else n?n("no java plugin found; install or enable the java plugin"):console.log("no java plugin found; install or enable the java plugin")}};e.error=function(c){n?n(c):i&&console.log(c)};e.ready=function(){function c(b){i&&console.log("applet:",null===k);try{k=-1!==g.indexOf("msie")||-1!==g.indexOf("chrome")||-1!==g.indexOf("safari")?window["midibridge-applet"]:document["midibridge-applet"],k.ready()}catch(a){i&&console.log(a);setTimeout(function(){c(b)},25);return}k?
b():(i&&console.log(k),setTimeout(function(){c(b)},25))}c(w)};e.getSequencer=function(){return!p?(i&&console.log("Sequencer not (yet) available"),null):p};e.getNoteName=function(c,b){return m[b][c%12]+""+Math.floor(c/12-1)};e.getNoteNumber=function(c,b){var a=-1,c=c.toUpperCase(),d;for(d in m)for(var e=m[d],f=0,g=e.length;f<g;f++)if(e[f]===c){a=f;break}return-1===a?"invalid note name":12+a+12*b};e.getStatus=function(c){return d[c]};e.getNiceTime=function(c){var b=c/1E3/1E3>>0,a=b/3600>>0,d=b%3600/
60>>0,b=b%60,c=c/1E3-36E5*a-6E4*d-1E3*b+0.5>>0;return""+(0<a?a+":":"")+(0<a?10>d?"0"+d:d:d)+":"+(10>b?"0"+b:b)+":"+(0===c?"000":10>c?"00"+c:100>c?"0"+c:c)};window.addEventListener||(window.addEventListener=function(c,b){window.attachEvent("onload",b)});e.wrapElement=function(c){if(g==="msie8/win")c.addEventListener=function(b,a){c.attachEvent(b,a)}};window.midiBridge=e})(window);