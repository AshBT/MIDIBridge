(function(){function v(){i=k.getMIDIAccess();f=k.getSequencer();var d=function(a){return a.replace(/data:audio\/mid[i]?;base64,/,"")};o={addEventListener:function(a,b){f.addEventListener(a,{listener:b})},stop:function(){f.stop()},play:function(){f.play()},pause:function(){f.pause()},loadBase64String:function(a){return f.loadBase64String(d(a))},playBase64String:function(a){return f.playBase64String(d(a))},getMicrosecondPosition:function(){return f.getMicrosecondPosition()},setMicrosecondPosition:function(a){f.setMicrosecondPosition(a)},
setTempoInBPM:function(a){f.setTempoInBPM(a)},getTempoFactor:function(){return f.getTempoFactor()},setTempoFactor:function(a){f.setTempoFactor(a)},getTempoInBPM:function(){return f.getTempoInBPM()},getTracks:function(){return f.getTracks()},muteTrack:function(a){return f.muteTrack(a)},unmuteTrack:function(a){return f.unmuteTrack(a)},getSequence:function(){return f.getSequence()},addDirectConnection:function(a){return f.addDirectConnection(a.getDevice())},removeDirectConnection:function(){f.removeDirectConnection()},
hasDirectConnection:function(){return f.hasDirectConnection()}};var b=function(a){if(!a)return j&&console.log("device does not exist"),null;try{if("input"==a.deviceType)a=i.getInput(a);else if("output"==a.deviceType)a=i.getOutput(a);else return j&&console.log("error while getting device",a.deviceName),null}catch(b){return j&&console.log("error while getting device",a.deviceName),null}return{close:function(){a.close()},open:function(){if(a.open())return!0;j&&console.log("could not open device",a.deviceName);
return!1},addEventListener:function(b,d){a.addEventListener(b,{listener:function(a){l&&1!==l[a.status]?j&&console.log("MIDI message intercepted",a.status,a.channel,a.data1,a.data2):d(a)}})},sendMIDIMessage:function(b){a.getDevice().isOpen()&&a.sendMIDIMessage(b)},toString:function(){return a.toString()},getDevice:function(){return a},deviceType:a.deviceType,deviceName:a.deviceName,deviceManufacturer:a.deviceManufacturer,deviceDescription:a.deviceDescription}};s({enumerateInputs:function(){return i.enumerateInputs()},
enumerateOutputs:function(){return i.enumerateOutputs()},getInput:function(a){return b(a)},getOutput:function(a){return b(a)},closeInputs:function(){i.closeInputs()},closeOutputs:function(){i.closeOutputs()},createMIDIMessage:function(a,b,d,e,c){return i.createMIDIMessage(a,b,d,e,c||-1)}})}function w(){var d=document.createElement("div"),b="";"safari/osx"!==g&&-1===g.indexOf("chrome")?(b=b+'<object tabindex="0" id="midibridge-applet" type="application/x-java-applet" height="1" width="1">'+('<param name="codebase" value="'+
q+'/" />'),b+='<param name="archive" value="'+t+'" />',b+='<param name="code" value="net.abumarkub.midi.MIDIApplet" /><param name="scriptable" value="true" /><param name="minJavaVersion" value="1.6" />Your browser needs the Java plugin to use the midibridge. You can download it <a href="http://www.java.com/en/" target="blank" title="abumarkub midibridge download java" rel="abumarkub midibridge download java">here</a></object>'):(b+='<applet id="midibridge-applet" code="net.abumarkub.midi.MIDIApplet.class" archive="'+
t+'" codebase="'+q+'" width="1" height="1" mayscript>',b+='<param name="minJavaVersion" value="1.6"></applet>');d.setAttribute("id","midibridge-java");d.innerHTML=b;document.body.appendChild(d)}try{console.log("")}catch(x){console={log:function(){}}}var e={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,MIDI_TIMECODE:241,SONG_POSITION:242,SONG_SELECT:243,TUNE_REQUEST:246,EOX:247,TIMING_CLOCK:248,START:250,CONTINUE:251,
STOP:252,ACTIVE_SENSING:254,SYSTEM_RESET:255,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_SOUNDFONT:"soundfont",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat",version:"0.6.0",noteNameModus:"sharp",userAgent:""},c=[],r=[],m={},q="lib",j=!1,s=null,p=null,l=null,t="midiapplet-"+e.version+".jar",k=null,i=null,f=null,o=null,h=navigator.userAgent.toLowerCase(),g;-1!==h.indexOf("firefox")?g="firefox":-1!==h.indexOf("chrome")?g="chrome":-1!==h.indexOf("safari")?
g="safari":-1!==h.indexOf("opera")?g="opera":-1!==h.indexOf("msie 7")?g="msie7":-1!==h.indexOf("msie 8")?g="msie8":-1!==h.indexOf("msie 9")&&(g="msie9");-1!==h.indexOf("linux")?g+="/linux":-1!==h.indexOf("macintosh")?g+="/osx":-1!==h.indexOf("windows")&&(g+="/win");e.userAgent=g;c[128]="NOTE OFF";c[144]="NOTE ON";c[160]="POLY PRESSURE";c[176]="CONTROL CHANGE";c[192]="PROGRAM CHANGE";c[208]="CHANNEL PRESSURE";c[224]="PITCH BEND";c[240]="SYSTEM EXCLUSIVE";c[241]="MIDI TIMECODE";c[242]="SONG POSITION";
c[243]="SONG SELECT";c[244]="RESERVED 1";c[245]="RESERVED 2";c[246]="TUNE REQUEST";c[247]="EOX";c[248]="TIMING CLOCK";c[249]="RESERVED 3";c[250]="START";c[251]="CONTINUE";c[252]="STOP";c[254]="ACTIVE SENSING";c[255]="SYSTEM RESET";for(var u in c)switch(h=parseInt(u),h){case e.NOTE_OFF:case e.NOTE_ON:case e.POLY_PRESSURE:case e.CONTROL_CHANGE:case e.PROGRAM_CHANGE:case e.CHANNEL_PRESSURE:case e.PITCH_BEND:r.push(h);for(var n=0;16>n;n++)c[h+n]=c[u];break;default:r.push(h)}m={sharp:"C C# D D# E F F# G G# A A# B".split(" "),
flat:"C D&#9837; D E&#9837; E F G&#9837; G A&#9837; A B&#9837; B".split(" "),soundfont:"C Db D Eb E F Gb G Ab A Bb B".split(" "),"enh-sharp":"B# C# C## D# D## E# F# F## G# G## A# A##".split(" "),"enh-flat":"D&#9837;&#9837; D&#9837; E&#9837;&#9837; E&#9837; F&#9837; G&#9837;&#9837; G&#9837; A&#9837;&#9837; A&#9837; B&#9837;&#9837; B&#9837; C&#9837;".split(" ")};e.init=function(){function d(a,b){document.body.style.color="#f00";document.body.style.fontSize="20px";document.body.style.padding="50px";
document.body.style.lineHeight="1.4em";document.body.innerHTML=a+" is not supported.<br/>please use "+b}if("safari/win"===g)d("Safari for Windows","Internet Explorer 8+, Chrome, Firefox or Opera");else if("msie7/win"===g)d("Internet Explorer 7","Internet Explorer 8+, Chrome, Firefox or Opera");else{var b=Array.prototype.slice.call(arguments);if(1===b.length&&"function"===typeof b[0])s=b[0];else if(2===b.length&&"object"===typeof b[0]&&"function"===typeof b[1]){var a=b[0],c,f,h,i,k;s=b[1];p=a.onError;
j=a.debug;q=a.javaDir||q;l={};var m=function(a,b){switch(a){case e.NOTE_OFF:case e.NOTE_ON:case e.POLY_PRESSURE:case e.CONTROL_CHANGE:case e.PROGRAM_CHANGE:case e.CHANNEL_PRESSURE:case e.PITCH_BEND:for(n=0;16>n;n++)b[a+n]=1;break;default:b[a]=1}};if(void 0!==a.filterCommands){b=0;for(c=r.length;b<c;b++){i=r[b];var o=!1;f=0;for(h=a.filterCommands.length;f<h;f++)if(k=a.filterCommands[f],k==i){o=!0;break}o||m(i,l)}}else if(void 0!==a.passCommands){b=0;for(c=a.passCommands.length;b<c;b++)m(a.passCommands[b],
l)}else l=null;j&&console.log(l,g)}navigator.javaEnabled()?w():p?p("No java plugin found; install or enable the java plugin"):(document.body.style.color="#f00",document.body.style.fontSize="20px",document.body.style.padding="50px",document.body.innerHTML="No java plugin found; install or enable the java plugin")}};e.error=function(d){p?p(d):j&&console.log(d)};e.ready=function(){(function b(a){j&&console.log("applet:",null===k);try{k=-1!==g.indexOf("msie")||-1!==g.indexOf("chrome")||-1!==g.indexOf("safari")?
window["midibridge-applet"]:document["midibridge-applet"],k.ready()}catch(c){j&&console.log(c);setTimeout(function(){b(a)},25);return}k?a():(j&&console.log(k),setTimeout(function(){b(a)},25))})(v)};e.getSequencer=function(){return!o?(j&&console.log("Sequencer not (yet) available"),null):o};e.getNoteName=function(d,b){return m[b][d%12]+""+Math.floor(d/12-1)};e.getNoteNumber=function(d,b){var a=-1,d=d.toUpperCase(),c;for(c in m)for(var e=m[c],f=0,g=e.length;f<g;f++)if(e[f]===d){a=f;break}return-1===
a?"invalid note name":12+a+12*b};e.getStatus=function(d){return c[d]};e.getNiceTime=function(d){var b=d/1E3/1E3>>0,a=b/3600>>0,c=b%3600/60>>0,b=b%60,d=d/1E3-36E5*a-6E4*c-1E3*b+0.5>>0;return""+(0<a?a+":":"")+(0<a?10>c?"0"+c:c:c)+":"+(10>b?"0"+b:b)+":"+(0===d?"000":10>d?"00"+d:100>d?"0"+d:d)};e.wrapElement=function(c){"msie8/win"===g&&(c.addEventListener=function(b,a){c.attachEvent(b,a)})};window.addEventListener||(window.addEventListener=function(c,b){window.attachEvent("onload",b)});window.midiBridge=
e})(window);